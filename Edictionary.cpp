#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#include<windows.h>

int wordsNumber =0;//单词总数 目 

typedef struct dictionary
{
	char word[20];
	char cn[80];
}data;

data dicSql[5000];//单词库 

int loadSql(data *sql,char path[100]);/*加载单词库数据*/
int printAction();/*输出用户提示函数*/
void dealAction(int action);/*定义指令处理函数*/
int searchWord(char word[20]);/*返回单词在单词库中的位置*/
int searchCn(char cn[80]);/*返回中文翻译在单词库中的位置*/
void saveSql();/*保存文件函数*/


/*主函数*/
int main()
{
	printf("              电子英汉词典设计\n\n");
	wordsNumber = loadSql(dicSql,"dictionary.txt");
	int action =-1; //定义动作变量 
	
	while(action!=7)
	{
		action =printAction();
		dealAction(action);
	}
	return 0;
}

/*加载单词库数据*/
int loadSql(data *sql,char path[100])
{
	FILE *fp =NULL;
	int i =0;
	if((fp = fopen(path,"r"))==NULL)
	{
		printf("文件读取失败！\n");
		return 0;
	}
	while(fscanf(fp,"%s\t%s",(sql+i)->word,(sql+i)->cn)!=EOF)
	{
		i++;
	}
	fclose(fp);
	printf("单词加载完毕!\n");
	printf("共计%d个单词数据\n",i);
	printf("\n"); 
	return i;
}

/*输出用户提示函数*/
int printAction()
{
	int n =0;
	printf("菜单：\n"); 
	printf("   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*\n");
	printf("   |            1、英译汉              |\n"); 
	printf("   *            2、汉译英              *\n");
	printf("   |            3、词条录入            |\n"); 
	printf("   *            4、词条修改            *\n");
	printf("   |            5、词条删除            |\n"); 
	printf("   *            6、信息保存            *\n");
	printf("   |            7、退出系统            |\n"); 
	printf("   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*\n");
	printf("请输入指令进行操作：");
	scanf("%d",&n);
	printf("\n"); 
	return n;
}

/*定义指令处理函数*/
void dealAction(int action)
{
	switch(action)
	{
		int pos;//单词位置 
		char word[20];
		char cn[80];
		case 1:
			printf("请输入您要查询的单词：");
			scanf("%s",word);
			printf("\n"); 
			pos = searchWord(word);
			if(pos!=-1)
			{
				printf("单词\'%s\'的意思是：%s\n",word,dicSql[pos].cn);
				printf("\n"); 
				Sleep(1500);
			} 
			else
			{
				printf("对不起，没有找到你所需要的单词!\n");
				printf("\n"); 
				Sleep(1500);
			}
			break;
		
		case 2:
			printf("请您输入汉语词意（关键词即可)：");
			printf("\n"); 
			scanf("%s",cn);
			pos = searchCn(cn);
			if(pos!=-1)
			{
				printf("该翻译的英语单词是：%s\n",dicSql[pos].word);
				printf("\n"); 
				Sleep(1500); 
			}
			else
			{
				printf("对不起，没有找到您所需要的翻译！\n");
				printf("\n"); 
				Sleep(1500);
			}
			break;
		
		case 3:
			printf("请您输入需要录入的单词(此处只需输入英文单词)：");
			scanf("%s",word);
			printf("\n"); 
			strcpy(dicSql[wordsNumber].word,word);
			printf("请您输入该单词的中文翻译：");	
			scanf("%s",cn);
			printf("\n"); 
			strcpy(dicSql[wordsNumber].cn,cn);
			wordsNumber++;
			saveSql(); 
			printf("补充词条完成!\n");
			printf("\n"); 
			Sleep(1500);
			break;
		
		case 4:
			printf("请您输入需要修改的单词(此处只需输入英文单词)：");
			scanf("%s",word);
			printf("\n"); 
			pos =searchWord(word);
			if(pos!=-1)
			{
				printf("该词条现在为：%s\t%s\n\n",dicSql[pos].word,dicSql[pos].cn);
				printf("请您输入该单词新的中文翻译：");
				scanf("%s",cn);
				printf("\n"); 
				strcpy(dicSql[pos].word,word);
				strcpy(dicSql[pos].cn,cn);
				saveSql(); 
				printf("修改词条完成!\n");
				printf("\n"); 
				printf("修改后该词条为：%s\t%s\n\n",dicSql[pos].word,dicSql[pos].cn);
				Sleep(1500);
			}
			else
			{
				printf("未找到您要修改的单词！\n");
				printf("\n"); 
				Sleep(1500);
			}
			break;
		
		case 5:
			printf("请输入您要删除的单词：");
			scanf("%s",word);
			printf("\n"); 
			pos =searchWord(word);
			if(pos!=-1)
			{
				char a[5] ="#";
				strcpy(dicSql[pos].word,a);
				strcpy(dicSql[pos].cn,a);
				saveSql();
				printf("删除成功！\n");
				printf("\n"); 
				Sleep(1500);
			}
			else
			    printf("对不起，没有找到您所需要的单词！\n"); 
			    printf("\n"); 
			    Sleep(1500);
			break;
			    
		case 6:
			saveSql();
			printf("信息保存成功！\n");
			printf("\n"); 
			Sleep(1500);
			break;
			
		case 7:
			printf("谢谢您的使用，再见！\n");
			break;
			
	}
} 

/*返回单词在单词库中的位置*/
int searchWord(char word[20])
{
	/*用二分法查找*/
	int low,mid,high;
	low =0;
	high = wordsNumber;
	while(low<=high)
	{
		mid =(low+high)/2;
		if(strcmp(dicSql[mid].word,word)>0)
		    high = mid-1;
		else if(strcmp(dicSql[mid].word,word)<0)
		    low = mid+1;
		else
		    return mid;
	}
	/*用顺序查找法查找*/ 
	int i=0;
    for(i=0;i<wordsNumber;i++)
    {
        if(strcmp(dicSql[i].word,word)==0)
            return i;
    }
    return -1;//如果找不到就返回-1 
} 

/*返回中文翻译在单词库中的位置*/
int searchCn(char cn[80])
{
	//用顺序查找法
	int i =0;
	for(;i<wordsNumber;i++)
	{
		if(strstr(dicSql[i].cn,cn)!=NULL)
		    return i;
	}
	return -1;// 如果找不到就返回-1 
}

/*保存文件函数*/
void saveSql()
{
	FILE *fp =NULL;
	if((fp =fopen("dictionary.txt","w"))==NULL)
	{
		printf("文件保存失败！\n");
		printf("\n"); 
	}
	int i =0;
	for(;i<wordsNumber;i++)
	{
		if(strcmp(dicSql[i].word,"#")!=0)
		{
			fprintf(fp,"%s\t%s\n",dicSql[i].word,dicSql[i].cn);
		}
	}
	fclose(fp);
}
 


